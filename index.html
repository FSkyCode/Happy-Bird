<!DOCTYPE html>
<html lang="es">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Bird</title>
<style>
  html, body {
    margin: 0;
    height: 100%;
    overflow: hidden;
    background: skyblue;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  canvas {
  width: 100vw;
  height: 100vh;
  max-width: 100%;
  max-height: 100%;
  border: none;
  }
  button {
    margin-top: 10px;
    padding: 12px 20px;
    font-size: 18px;
    border-radius: 10px;
    border: none;
    background: gold;
    font-weight: bold;
    box-shadow: 0 4px #b88a00;
  }
  button:active {
    transform: translateY(2px);
    box-shadow: 0 2px #b88a00;
  }
.jump {
  width: 100vw;          /* ancho completo */
  height: 18vh;          /* bien grande */
  background: rgba(255, 215, 0, 0.8);
  border: none;
  border-radius: 0;
  user-select: none;     /* no seleccionable */
  -webkit-user-select: none;
  font-size: 0;          /* quita texto visible */
}
.rank {
  position: absolute;
  top: 10px;
  right: 10px;
  padding: 12px 16px;
  font-size: 20px;
  background: gold;
  border-radius: 10px;
  border: none;
  box-shadow: 0 4px #b88a00;
  user-select: none;
}
.rank:active {
  transform: translateY(2px);
  box-shadow: 0 2px #b88a00;
}
.jump:active {
  background: rgba(255, 215, 0, 1);
}
</style>
</head>
<body>

<canvas id="game"></canvas>
<div>
  <button id="jumpBtn" class="jump"></button>
<button id="rankingBtn" class="rank">üèÜ</button>
</div>

<script>
// M√∫sica de fondo
const music = new Audio("happybird-theme.mp3");
music.loop = true;
music.volume = 0.4; // Volumen (0.0 a 1.0)
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// Ajuste de pantalla
canvas.width = window.innerWidth > 400 ? 400 : window.innerWidth - 20;
canvas.height = window.innerHeight - 150;

// Botones
const jumpBtn = document.getElementById("jumpBtn");
const rankingBtn = document.getElementById("rankingBtn");

// Variables del juego
let birdY = canvas.height / 2;
let speed = 0;
let gravity = 0.5;
let pipes = [{x: canvas.width, h: 150}];
let score = 0;
let difficulty = 1;
let gameOver = false;
let waitingRestart = false;

// Pedir iniciales
let player = prompt("Ingresa tus iniciales (3 letras):");
player = player ? player.toUpperCase().slice(0,3) : "AAA";

// Cargar ranking guardado
let ranking = JSON.parse(localStorage.getItem("ranking") || "{}");

// Guardar puntaje
function saveScore() {
  if (!ranking[player] || score > ranking[player]) {
    ranking[player] = score;
    localStorage.setItem("ranking", JSON.stringify(ranking));
  }
}

// Reiniciar
function resetGame() {
  birdY = canvas.height / 2;
  speed = 0;
  score = 0;
  difficulty = 1;
  pipes = [{x: canvas.width, h: 150}];
  gameOver = false;
  waitingRestart = false;
  loop();
}

// Dibujar loop principal
function loop() {
  if (gameOver) return;

  ctx.fillStyle = "skyblue";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // F√≠sica
  speed += gravity;
  birdY += speed;

  // Bird
  const birdX = 60;
  const r = 12;
  ctx.fillStyle = "yellow";
  ctx.beginPath();
  ctx.arc(birdX, birdY, r, 0, Math.PI * 2);
  ctx.fill();

  // Tubos
  pipes.forEach(p => {
    p.x -= 2 * difficulty;
    ctx.fillStyle = "green";
    ctx.fillRect(p.x, 0, 40, p.h);
    ctx.fillRect(p.x, p.h + 100, 40, canvas.height);

    // Colisi√≥n real
    if (
      birdX + r > p.x && birdX - r < p.x + 40 &&
      (birdY - r < p.h || birdY + r > p.h + 100)
    ) {
      gameOver = true;
      saveScore();
      showGameOver();
      return;
    }

    // Tubo pasa
    if (p.x < -40) {
      p.x = canvas.width;
      p.h = Math.random() * (canvas.height - 200);
      score++;
      difficulty += 0.01;
    }
  });

  // L√≠mite suelo
  if (birdY + r > canvas.height) {
    gameOver = true;
    saveScore();
    showGameOver();
    return;
  }

  // UI
  ctx.fillStyle = "black";
  ctx.font = "16px sans-serif";
  ctx.fillText("Jugador: " + player, 10, 20);
  ctx.fillText("Puntaje: " + score, 10, 40);
  ctx.fillText("Dificultad: " + (difficulty * 100).toFixed(0) + "%", 10, 60);

  requestAnimationFrame(loop);
}

function showGameOver() {
  ctx.fillStyle = "red";
  ctx.font = "28px sans-serif";
  ctx.fillText("GAME OVER", canvas.width/2 - 90, canvas.height/2);
  ctx.fillStyle = "black";
  ctx.font = "20px sans-serif";
  ctx.fillText("Toca para reiniciar", canvas.width/2 - 95, canvas.height/2 + 40);
  waitingRestart = true;
}

// Bot√≥n Saltar
jumpBtn.addEventListener("click", () => {
  // Si est√° muerto ‚Üí espera segundo toque para reinicio
  if (gameOver && waitingRestart) {
    resetGame();
    return;
  }

  // Si muere pero a√∫n no se ha mostrado la espera
  if (gameOver && !waitingRestart) return;

  // Salto normal
  speed = -7;
});

// Ranking
rankingBtn.addEventListener("click", () => {
  saveScore();
  window.location.href = "ranking.html";
});

loop();
</script>
</body>
</html>
